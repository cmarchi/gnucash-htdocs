# -*- rst -*-

----
TODO
----

- re-work page content for new-style translations (one big block)
  - re-flow existing po-file content.
- update features screenshots
- revise docs.phtml
- fix double-slash on langdir='' mlist search menu URLs

-------------------------------------------------
Notes about multi-lingual gnucash website content
-------------------------------------------------

- all pages must call lang.php to bring in gettext support.
- It would be nice to use the same containing structure for all translations.
- Phrase content can probably be po-style translated well.
- Body/paragraph content probably wants to be block-replaced.
- We're fine not doing auto-language negotiation.

----------------------------------------
www.gnucash.org coding conventions/notes
----------------------------------------

There are three main classes of links:

- external resources [$top_dir[/externals]]
  - www: relative
  - !www: relative

- translations [$top_dir/[«lang»]]
  - www: relative
  - !www: relative

- navigation [$home]
  - www: relative
  - !www: url-prefixed ("http://www.gnucash.org/file.phtml")

                        | www.gnucash.org  |  lists.gnucash.org        |
                        +------------------+---------------------------+
           external (C) |   ./[externals/] |  ./[externals/]           | \
        external (lang) |  ../[externals/] | ../[externals/]           |  \,- $top_dir
        translation (C) |   ./[lang]       |  ./[lang]                 |  / 
     translation (lang) |  ../[lang]       | ../[lang]                 | /
         navigation (C) |   ./             | http://www.[...]/         |  \,- $home
      navigation (lang) |   ./             | http://www.[...]/[lang]/  |  /
                        +------------------+---------------------------+

As such:

  $top_dir := the relative reference to the top of the relative website; this
    should be used for language-independent resources (stylesheets, images, php
    includes), but not for links...

  $home := a prefix for navigational URLs; for everything but
    lists.gnucash.org, this'll be ".", but for lists.gnucash.org it'll
    be "http://www.gnucash.org/".

As well, the following variables should be set:

- per directory:

  $locale := the LANG to use for gettext.

- per file:

  $title := the text of the page.

  $homepage := if the file is the homepage; controls RSS feed linkage.

----------------------
Preparing translations
----------------------

The below is a good description of the steps; in short, you want to say:

    $ make pot msgmerge mos

-----

First, make sure the pot file is up to date.  You can do that by running
the command:

    $ make pot

Now merge the new content into your translation, substituting the name of 
your po file in the command:

    $ msgmerge po/en_GB.po po/gnucash-htdocs.pot -o po/en_GB.po

Finally, see the size of the task ahead:

    $ msgfmt -c --statistics po/en_GB.po

Whilst editing the translation, run the msgfmt command from time to
time to catch errors and let you know how much is left to do.

When you come across fuzzy markers: (#, fuzzy), check whether the
proposed translation is a valid translation. If it is, then remove
the fuzzy marker. If it is not, either edit the translation and
remove the fuzzy marker, or leave the fuzzy marker where it is --
this message will then be treated as untranslated.

When you have no fuzzy and no untranslated messages, update the binary
translation file for your locale:

    $ make de [fr nl ...]

Which will build an individual translation, or:

    $ make mos

Which will make all the known translations.

----------------------
Publishing the website
----------------------

Once you've got the website content up to date, you need to publish
the content from the beta site to the main website (and beta search
site to the main search site).  To do this, you need to merge your
changes from the 'trunk' into the 'published' branch.  Here's how you
do that:

    svn checkout .../repo/htdocs/branches/published htdocs-pub
    cd htdocs-pub
    svn log --stop-on-copy emulate-globals.php
    # find the last merge point from trunk
    svn merge -r <last_merge_point>:<head_rev> .../htdocs/trunk
    # resolve conflicts
    svn commit
    # Make sure you put <head_rev> into your comment!!!!!!!
